{"ast":null,"code":"import { setUserDataLogin, setUserDataToken, setIsLogin, reset } from './hooks';\nimport Cookies from 'universal-cookie';\nimport jwtDecode from 'jwt-decode';\nimport axios from 'axios';\nconst url = process.env.REACT_APP_BASE_URL;\naxios.defaults.withCredentials = true;\nconst axiosInstance = axios.create({\n  baseURL: url,\n  headers: {\n    \"Content-Type\": \"application/json\"\n  }\n});\naxiosInstance.interceptors.request.use(async config => {\n  console.log(config);\n  const token = await interceptor();\n  console.log(token);\n\n  if (token || token !== undefined) {\n    config.headers['Authorization'] = token;\n  }\n\n  return config;\n});\nexport { axiosInstance };\nexport const cookies = new Cookies();\nexport const interceptor = async () => {\n  const refreshToken = cookies.get('refreshToken');\n  const getToken = cookies.get('token');\n  console.log({\n    token: getToken\n  });\n  console.log({\n    refreshToken\n  });\n\n  try {\n    if (getToken || getToken !== undefined) {\n      const currentTime = new Date();\n      const {\n        exp\n      } = jwtDecode(getToken);\n\n      if (exp * 1000 < currentTime.getTime()) {\n        const {\n          token\n        } = await axios.post(`${url}/token`, {\n          refreshToken\n        });\n\n        if (token) {\n          cookies.set('token', token);\n        }\n\n        return `Bearer ${token}`;\n      }\n\n      return `Bearer ${getToken}`;\n    }\n  } catch (error) {\n    console.log(`${error}`);\n  }\n};\nexport const mapStateToProps = state => ({\n  persist: state.persist,\n  temporer: state.temporer\n});\nexport const mapDispatchToProps = dispatch => {\n  return {\n    setUserDataLogin: userData => dispatch(setUserDataLogin(userData)),\n    setUserDataToken: userData => dispatch(setUserDataToken(userData)),\n    setIsLogin: data => dispatch(setIsLogin(data)),\n    reset: () => dispatch(reset())\n  };\n};","map":{"version":3,"sources":["/home/inim/Documents/Data/DESA/DOMAS/client/src/app/functions.ts"],"names":["setUserDataLogin","setUserDataToken","setIsLogin","reset","Cookies","jwtDecode","axios","url","process","env","REACT_APP_BASE_URL","defaults","withCredentials","axiosInstance","create","baseURL","headers","interceptors","request","use","config","console","log","token","interceptor","undefined","cookies","refreshToken","get","getToken","currentTime","Date","exp","getTime","post","set","error","mapStateToProps","state","persist","temporer","mapDispatchToProps","dispatch","userData","data"],"mappings":"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","sourcesContent":["import { \n    setUserDataLogin, setUserDataToken, setIsLogin,\n    reset\n} from './hooks' \nimport { StateToProps, DispatchToProps, UserData, JWTDecode, Req } from '../interface/Interfaces'\nimport Api from '../api/Api'\nimport Cookies from 'universal-cookie'\nimport jwtDecode from 'jwt-decode'\nimport axios, { AxiosInstance } from 'axios'\n\n\nconst url = process.env.REACT_APP_BASE_URL\naxios.defaults.withCredentials = true\n\nconst axiosInstance: AxiosInstance =  axios.create({\n    baseURL: url,\n    headers: {\n        \"Content-Type\": \"application/json\"   \n    }\n})\naxiosInstance.interceptors.request.use(async config => {\n    console.log(config)\n    const token = await interceptor()\n    console.log(token)\n    if(token || token !== undefined){\n        config.headers['Authorization'] = token\n    }\n    return config\n})\n\nexport { axiosInstance }\n\nexport const cookies = new Cookies()\n\nexport const interceptor = async () => {\n    const refreshToken = cookies.get('refreshToken')\n    const getToken = cookies.get('token')\n    console.log({ token: getToken })\n    console.log({ refreshToken })\n    try {\n        if(getToken || getToken !== undefined){\n            const currentTime = new Date()\n            const { exp }: JWTDecode = jwtDecode(getToken)\n            if((exp! * 1000) < currentTime.getTime()){\n                const { token }: Req = await axios.post(`${url}/token`, { refreshToken })\n                if(token){\n                    cookies.set('token',token)\n                }\n                return `Bearer ${ token }`\n            }\n            return `Bearer ${ getToken }`\n        }\n    } catch (error) {\n        console.log(`${error}`)\n    }\n}\n\n\nexport const mapStateToProps = (state: StateToProps) => ({\n    persist: state.persist,\n    temporer : state.temporer\n})\n\nexport const mapDispatchToProps = (dispatch: Function): DispatchToProps => {\n    return {\n        setUserDataLogin: (userData: UserData) => dispatch(setUserDataLogin(userData)),\n        setUserDataToken: (userData: UserData) => dispatch(setUserDataToken(userData)),\n        setIsLogin: (data: boolean) => dispatch(setIsLogin(data)),\n        reset: () => dispatch(reset())\n    }\n}"]},"metadata":{},"sourceType":"module"}